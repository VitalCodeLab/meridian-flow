# ESP32 8x8 LED 矩阵显示系统

一个功能丰富的 ESP32 8x8 LED 矩阵显示项目，支持音频可视化、文字显示和 Web 控制。

## 功能特性

### 🎵 音频可视化

- **频谱分析**: 实时 FFT 频谱显示
- **多种可视化模式**: 频谱条、圆形、波形、粒子效果
- **音频特效**: 节拍检测、频率段分析、音量显示

### 📝 文字显示

- **滚动文字**: 支持自定义滚动速度
- **静态文字**: 居中显示固定文字
- **5x7 像素字体**: 清晰的字符显示

### 🎨 预设图案

- ❤️ 爱心图案
- 😊 笑脸图案
- ⬆️⬇️⬅️➡️ 方向箭头
- 🔢 数字显示 (0-9)
- 🎵 均衡器效果

### 🌐 Web 控制界面

- **直观的控制面板**: 现代化 Web 界面
- **实时控制**: 即时切换显示模式
- **WiFi 热点**: 无需外部网络
- **响应式设计**: 支持手机和电脑访问

## 硬件要求

### 主要组件

- **ESP32 开发板** (ESP32-C3 推荐)
- **8x8 WS2812B LED 矩阵** (64 个 LED)
- **杜邦线** 若干
- **电源** 5V 2A (推荐)

### 连接方式

```
ESP32 GPIO2  →  LED矩阵 DIN
ESP32 5V     →  LED矩阵 VCC
ESP32 GND    →  LED矩阵 GND
```

## 软件环境

### 开发环境

- **PlatformIO** (推荐)
- **Visual Studio Code** + PlatformIO 扩展

### 依赖库

- FastLED@^3.6.0 - LED 控制
- ArduinoFFT@^1.6.0 - 音频频谱分析
- ArduinoJson@^6.21.3 - JSON 数据处理

## 编译和上传

### 1. 克隆或下载项目

```bash
git clone <项目地址>
cd esp32-dev
```

### 2. 编译矩阵显示版本

```bash
pio run -t upload -e matrix
```

### 3. 监控串口输出

```bash
pio device monitor -p COM_PORT -b 115200
```

## 使用方法

### 1. 首次启动

1. 上传代码到 ESP32
2. 串口监视器显示初始化信息
3. ESP32 创建 WiFi 热点 "ESP32_Matrix"
4. 密码: "12345678"

### 2. Web 控制

1. 连接到 WiFi 热点
2. 浏览器访问: `http://192.168.4.1`
3. 使用控制面板操作 LED 矩阵

### 3. 演示模式

- 系统启动后自动进入演示模式
- 每 5 秒自动切换不同效果
- 可通过 Web 界面关闭/开启

## 显示模式详解

### 音频频谱模式

- **频谱条**: 8 个垂直频段显示
- **圆形**: 中心向外圆形可视化
- **粒子**: 动态粒子效果
- **波形**: 实时音频波形

### 文字显示模式

- **滚动文字**: 从右到左滚动
- **静态文字**: 居中固定显示
- **自定义颜色**: 支持 RGB 颜色设置

### 动画模式

- 自动循环播放预设动画
- 包括爱心、笑脸、均衡器等
- 平滑过渡效果

## API 接口

### RESTful API

系统提供 HTTP API 接口，可用于自定义控制：

#### 显示模式

```
GET /api/mode?value=<0-6>
```

- 0: 关闭
- 1: 音频频谱
- 2: 音频波形
- 3: 文字滚动
- 4: 静态文字
- 5: 动画
- 6: 自定义图案

#### 文字设置

```
GET /api/text?value=<文字内容>
GET /api/static_text?value=<文字内容>
```

#### 亮度控制

```
GET /api/brightness?value=<0-255>
```

#### 预设图案

```
GET /api/pattern?name=<heart|smiley|arrow_up|arrow_down|arrow_left|arrow_right>
```

## 技术细节

### 音频处理

- 采样率: 16kHz
- FFT 点数: 64 点
- 频段划分: 8 个频段
- 实时处理: 非阻塞更新

### 显示优化

- 帧率: ~30FPS
- 内存使用: < 20KB
- 功耗: < 200mA (全亮)
- 颜色深度: 24 位 RGB

### WiFi 配置

- 模式: AP 热点
- IP 地址: 192.168.4.1
- 信道: 1
- 最大连接: 4 台设备

## 故障排除

### 常见问题

**LED 不亮**

- 检查接线是否正确
- 确认电源供电充足
- 检查 GPIO 引脚配置

**WiFi 连接失败**

- 重启 ESP32 设备
- 检查密码是否正确
- 确认设备支持 2.4GHz WiFi

**Web 界面无响应**

- 检查 ESP32 是否正常启动
- 确认 IP 地址访问正确
- 尝试刷新浏览器

**音频可视化无效果**

- 确认音频模块正常工作
- 检查 FFT 计算是否正常
- 调整音频输入增益

### 调试方法

1. 使用串口监视器查看日志
2. 检查 Web 控制台错误信息
3. 逐步测试各功能模块

## 扩展开发

### 添加新的可视化效果

1. 在`matrix_display.cpp`中添加新的绘制函数
2. 在`VisualizationType`枚举中添加新类型
3. 在`updateAudioSpectrum()`中添加调用逻辑

### 添加新的预设图案

1. 在`MatrixDisplay`类中添加图案函数
2. 在 Web 界面中添加对应按钮
3. 注册相应的 API 路由

### 自定义音频源

可以替换`MatrixAudio`类为真实音频输入：

- I2S 麦克风
- ADC 模拟输入
- 蓝牙音频流

## 开源参考

本项目参考了以下开源项目：

- **FastLED** - 高性能 LED 控制库
- **ArduinoFFT** - 快速傅里叶变换
- **AuroraDrop** - 音频可视化灵感
- **WLED** - LED 控制系统设计

## 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

## 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目！

---

**享受你的 8x8 LED 矩阵显示之旅！** 🚀✨
