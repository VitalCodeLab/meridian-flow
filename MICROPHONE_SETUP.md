# ESP32-C3 麦克风连接指南

## 🎤 硬件连接

### MAX9814 麦克风模块连接

```
MAX9814模块    →    ESP32-C3
VCC (3.3V)    →    3V3
GND           →    GND
OUT           →    GPIO4 (音频输入)
```

### LED 矩阵连接

```
LED矩阵       →    ESP32-C3
VCC (5V)      →    5V
GND           →    GND
DIN           →    GPIO2 (数据输入)
```

## 🔧 硬件要求

### 必需组件

1. **ESP32-C3 开发板**
2. **MAX9814 麦克风模块**
3. **8x8 WS2812B LED 矩阵**
4. **杜邦线** 若干
5. **电源** 5V 2A (推荐)

### MAX9814 麦克风特性

- **高灵敏度麦克风放大器**
- **自动增益控制 (AGC)**
- **宽动态范围**
- **低噪声设计**
- **3.3V 供电**

## 📊 音频处理参数

### 采样设置

- **采样率**: 8kHz
- **采样位数**: 12-bit (ESP32-C3 ADC)
- **FFT 点数**: 128 点
- **更新率**: ~400Hz

### 频段分析

- **低频段**: 0-150Hz (低音)
- **中频段**: 150-1000Hz (人声)
- **高频段**: 1000Hz+ (高音)

### 音高检测

- **检测范围**: 80Hz-1000Hz
- **算法**: 自相关
- **置信度**: 0-1 (0.3 以上有效)

## 🎵 功能特性

### 实时音频分析

1. **音量检测** - RMS 音量计算
2. **频谱分析** - FFT 频谱分解
3. **音高检测** - 基频提取
4. **频段能量** - 低中高频分离

### 可视化效果

1. **频谱条** - 8 个频段实时显示
2. **圆形可视化** - 径向频谱显示
3. **波形显示** - 实时音频波形
4. **粒子效果** - 动态音频响应

### 音高映射

- **音高到 LED 长度映射**
- **可调频率范围**
- **置信度过滤**
- **冷却时间控制**

## 🔧 调试和优化

### 串口调试信息

```bash
# 监控串口输出
pio device monitor -p COM_PORT -b 115200
```

### 典型输出

```
audio level=0.234 low=0.156 mid=0.089 high=0.045 en=1 mode=1
pitch Hz=440.2 conf=0.87
```

### 性能优化

1. **调整敏感度**: `analyzer.setSensitivity(1.5)`
2. **滤波设置**: 修改 FFT 窗口类型
3. **更新频率**: 调整`tick()`调用间隔

## 🛠️ 故障排除

### 无音频信号

**检查项**:

- MAX9814 供电是否正常 (3.3V)
- GPIO4 连接是否正确
- 麦克风模块是否损坏

**测试方法**:

```cpp
// 在loop()中添加调试代码
float rawADC = analogRead(4);
Serial.printf("ADC Raw: %d\n", rawADC);
```

### 音频质量差

**可能原因**:

- 电源噪声
- 接线松动
- 环境噪声过大

**解决方案**:

- 使用滤波电容
- 检查接线质量
- 调整麦克风增益

### 频谱显示异常

**检查项**:

- FFT 计算是否正常
- 频段映射是否正确
- 显示更新频率

**调试代码**:

```cpp
// 显示频段数据
Serial.printf("Low: %.3f, Mid: %.3f, High: %.3f\n",
              audioAnalyzer.low(),
              audioAnalyzer.mid(),
              audioAnalyzer.high());
```

## 📱 BLE 控制命令

### 音频相关命令

```
beat              # 节拍检测
frequency/freq    # 频率段显示
volume/vol        # 音量表
```

### 敏感度调整

```cpp
// 在BLE命令中添加
sensitivity <0.1-5.0>  # 设置音频敏感度
```

## 🎯 使用场景

### 音乐可视化

- **现场演出** - 实时音乐频谱
- **家庭音响** - 音乐节奏灯
- **录音室** - 音频监测

### 语音应用

- **语音识别** - 音高检测
- **卡拉 OK** - 音高指示
- **会议系统** - 音量监测

### 环境监测

- **噪声监测** - 环境音量
- **频率分析** - 声音特征
- **振动检测** - 机械状态

---

**硬件连接完成后，系统将使用真实麦克风进行音频分析！** 🎤✨

## ⚠️ 注意事项

1. **电源质量**: 确保稳定的 3.3V 和 5V 供电
2. **接线检查**: 连接前确认接线正确
3. **静电防护**: 操作时注意防静电
4. **软件调试**: 使用串口监视器进行调试
5. **环境要求**: 避免强电磁干扰环境
